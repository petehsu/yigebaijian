# ä¸€ä¸ªæ‘†ä»¶ (YiGeBaiJian)

[Click to jump to English Version](#english-version)

ä¸€ä¸ªç®€æ´ä¼˜é›…çš„Androidæ—¶é—´æ˜¾ç¤ºåº”ç”¨ï¼Œä¸“æ³¨äºæ—¶é—´çš„ç¾å­¦å‘ˆç°ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ• **å®æ—¶æ—¶é—´æ˜¾ç¤º** - æ”¯æŒå¤šç§æ—¶é—´æ ¼å¼å’Œç²¾åº¦
- ğŸ¨ **è‡ªå®šä¹‰ç•Œé¢** - å¯è°ƒèŠ‚é€æ˜åº¦ã€å­—ä½“å¤§å°ã€é¢œè‰²ç­‰
- ğŸ“Š **å¹´åº¦è¿›åº¦** - ç›´è§‚æ˜¾ç¤ºå¹´åº¦æ—¶é—´è¿›åº¦
- ğŸŒŠ **åŠ¨æ€æ•ˆæœ** - æ³¢æµªåŠ¨ç”»å’Œé›¨æ»´æ•ˆæœ
- âš™ï¸ **ä¸°å¯Œè®¾ç½®** - å¤šç§æ˜¾ç¤ºé€‰é¡¹å’Œä¸ªæ€§åŒ–é…ç½®

## æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Kotlin
- **æ¡†æ¶**: Android Jetpack Compose
- **æ¶æ„**: MVVM
- **æœ€ä½æ”¯æŒ**: Android API 21+

## å®‰è£…ä½¿ç”¨

1. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„APKæ–‡ä»¶
2. åœ¨Androidè®¾å¤‡ä¸Šå®‰è£…
3. æ‰“å¼€åº”ç”¨å³å¯ä½¿ç”¨

## å¼€å‘ç¯å¢ƒ

- Android Studio
- Kotlin 1.9+
- Gradle 8.0+

## ç‰ˆæœ¬å†å²

### v3.0 (å½“å‰ç‰ˆæœ¬)
- æ–°å¢æ­Œè¯å¹¿æ’­æ¥æ”¶åŠŸèƒ½ï¼Œæ”¯æŒä¸LyraPlayerç­‰éŸ³ä¹è½¯ä»¶è”åŠ¨
- æç®€ç•Œé¢4æ”¯æŒå®æ—¶æ˜¾ç¤ºæ­Œè¯ï¼Œæ— æ­Œè¯æ—¶æ˜¾ç¤ºä¸€è¨€
- ä¼˜åŒ–å¹¿æ’­æ¥æ”¶æœºåˆ¶ï¼Œæé«˜è·¨åº”ç”¨é€šä¿¡ç¨³å®šæ€§
- å®Œå–„Android 14+å…¼å®¹æ€§ï¼Œç¬¦åˆæœ€æ–°å®‰å…¨è¦æ±‚
- æå‡æ•´ä½“ç”¨æˆ·ä½“éªŒå’ŒåŠŸèƒ½å®Œæ•´æ€§

### v2.0
- ä¿®å¤å¹´åº¦è¿›åº¦ç•Œé¢æ¯«ç§’æ˜¾ç¤ºæ›´æ–°ç¼“æ…¢çš„é—®é¢˜
- æ·»åŠ ä¸»ç•Œé¢æ—¶é—´é¢œè‰²è®¾ç½®åŠŸèƒ½
- ä¼˜åŒ–ç•Œé¢å¯¼èˆªé€»è¾‘
- å®Œå–„å¹´åº¦è¿›åº¦ç½‘æ ¼æ˜¾ç¤º
- ä¿®å¤å¤šé¡¹ç•Œé¢æ˜¾ç¤ºå’Œäº¤äº’é—®é¢˜

### v1.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- åŸºç¡€æ—¶é—´æ˜¾ç¤ºåŠŸèƒ½
- å¹´åº¦è¿›åº¦æ˜¾ç¤º
- åŸºæœ¬è®¾ç½®åŠŸèƒ½

## ä¸»è¦ä¿®å¤è®°å½•

æœ¬é¡¹ç›®åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¿®å¤äº†å¤šä¸ªé‡è¦é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼š

- **ç•Œé¢å¯¼èˆªé€»è¾‘é”™è¯¯** - ä¿®å¤å·¦æ»‘æ‰‹åŠ¿å¯¼èˆªè·³è¿‡ç•Œé¢çš„é—®é¢˜
- **å¹´åº¦è¿›åº¦ç½‘æ ¼æ˜¾ç¤º** - ä¿®å¤ç½‘æ ¼ç•Œé¢æ»šåŠ¨å’Œæ˜¾ç¤ºé—®é¢˜
- **æ—¶é—´å®æ—¶æ›´æ–°** - è§£å†³æ—¶é—´æ˜¾ç¤ºå»¶è¿Ÿå’Œä¸åŒæ­¥é—®é¢˜
- **æ¯«ç§’æ˜¾ç¤ºä¼˜åŒ–** - æå‡æ¯«ç§’çº§æ—¶é—´æ˜¾ç¤ºçš„æµç•…åº¦
- **ç•Œé¢è®¾ç½®åŠŸèƒ½** - æ·»åŠ æ—¶é—´é¢œè‰²ç­‰ä¸ªæ€§åŒ–è®¾ç½®é€‰é¡¹

## è¯¦ç»†bugä¿®å¤è®°å½•

# Bugä¿®å¤æ–‡æ¡£

æœ¬æ–‡æ¡£è®°å½•äº†åœ¨å¼€å‘è¿‡ç¨‹ä¸­å‘ç°å¹¶ä¿®å¤çš„æ‰€æœ‰bugã€‚

## Bug #1: ç•Œé¢å¯¼èˆªé€»è¾‘é”™è¯¯

### é—®é¢˜æè¿°
- **å‘ç°æ—¶é—´**: å¼€å‘åˆæœŸ
- **é—®é¢˜**: åœ¨`LifeProgressPanel`ä¸­çš„å·¦æ»‘æ‰‹åŠ¿å¯¼èˆªé€»è¾‘é”™è¯¯
- **å…·ä½“è¡¨ç°**: å·¦æ»‘æ‰‹åŠ¿ç›´æ¥è·³è½¬åˆ°æ‘†çƒç•Œé¢ï¼Œè·³è¿‡äº†å¹´åº¦è¿›åº¦ç½‘æ ¼ç•Œé¢
- **é¢„æœŸè¡Œä¸º**: å·¦æ»‘åº”è¯¥å¯¼èˆªåˆ°`GridProgressPanel`ï¼ˆå¹´åº¦è¿›åº¦ç½‘æ ¼ç•Œé¢ï¼‰

### æ ¹æœ¬åŸå› 
åœ¨`MainActivity.kt`çš„`LifeProgressPanel`ç»„ä»¶ä¸­ï¼Œå·¦æ»‘æ‰‹åŠ¿çš„å¤„ç†é€»è¾‘é”™è¯¯åœ°è®¾ç½®äº†`_showPendulumBallPanel.value = true`ï¼Œç›´æ¥è·³è½¬åˆ°æ‘†çƒç•Œé¢ã€‚

### ä¿®å¤æ–¹æ¡ˆ
ä¿®æ”¹`MainActivity.kt`ä¸­`LifeProgressPanel`çš„å·¦æ»‘æ‰‹åŠ¿å¤„ç†é€»è¾‘ï¼š
```kotlin
// ä¿®å¤å‰
if (dragAmount < -100) {
    _showPendulumBallPanel.value = true
}

// ä¿®å¤å
if (dragAmount < -100) {
    _showHourglassProgress.value = true
}
```

### ä¿®å¤ç»“æœ
- æ­£ç¡®çš„å¯¼èˆªæµç¨‹ï¼šä¸»ç•Œé¢ï¼ˆä¸Šæ»‘ï¼‰â†’ å¹´åº¦è¿›åº¦é¢æ¿ï¼ˆå·¦æ»‘ï¼‰â†’ ç”Ÿå‘½è¿›åº¦é¢æ¿ï¼ˆå·¦æ»‘ï¼‰â†’ å¹´åº¦ç½‘æ ¼é¢æ¿ï¼ˆå·¦æ»‘ï¼‰â†’ æ‘†çƒé¢æ¿
- æ‰€æœ‰ç•Œé¢å¯¼èˆªé€»è¾‘æ­£å¸¸å·¥ä½œ

---

## Bug #2: å¹´åº¦è¿›åº¦ç½‘æ ¼ç•Œé¢æ˜¾ç¤ºä¸å®Œæ•´

### é—®é¢˜æè¿°
- **å‘ç°æ—¶é—´**: ç•Œé¢å¯¼èˆªä¿®å¤å
- **é—®é¢˜**: å¹´åº¦è¿›åº¦ç½‘æ ¼ç•Œé¢åªæ˜¾ç¤ºä¸‰è¡Œè“è‰²æ–¹å—
- **å…·ä½“è¡¨ç°**: æ— æ³•çœ‹åˆ°å®Œæ•´çš„365ä¸ªæ—¥æœŸæ–¹å—
- **é¢„æœŸè¡Œä¸º**: åº”è¯¥æ˜¾ç¤ºå®Œæ•´çš„365ä¸ªæ—¥æœŸæ–¹å—ï¼Œä»£è¡¨ä¸€å¹´ä¸­çš„æ¯ä¸€å¤©

### æ ¹æœ¬åŸå› 
åœ¨`MainActivity.kt`çš„`GridProgressPanel`ä¸­ï¼Œ`LazyVerticalGrid`çš„`userScrollEnabled`å‚æ•°è¢«è®¾ç½®ä¸º`false`ï¼Œç¦ç”¨äº†æ»šåŠ¨åŠŸèƒ½ï¼Œå¯¼è‡´åªèƒ½çœ‹åˆ°å‰å‡ è¡Œçš„å†…å®¹ã€‚

### ä¿®å¤æ–¹æ¡ˆ
ä¿®æ”¹`MainActivity.kt`ä¸­`GridProgressPanel`çš„`LazyVerticalGrid`é…ç½®ï¼š
```kotlin
// ä¿®å¤å‰
LazyVerticalGrid(
    columns = GridCells.Fixed(7),
    userScrollEnabled = false,  // ç¦ç”¨æ»šåŠ¨
    // ...
)

// ä¿®å¤å
LazyVerticalGrid(
    columns = GridCells.Fixed(7),
    userScrollEnabled = true,   // å¯ç”¨æ»šåŠ¨
    // ...
)
```

### ä¿®å¤ç»“æœ
- ç”¨æˆ·å¯ä»¥å‚ç›´æ»šåŠ¨æŸ¥çœ‹æ‰€æœ‰365ä¸ªæ—¥æœŸæ–¹å—
- æ­£ç¡®çš„é¢œè‰²ç¼–ç ï¼šè“è‰²ï¼ˆè¿‡å»çš„æ—¥å­ï¼‰ã€åŠé€æ˜ï¼ˆæœªæ¥çš„æ—¥å­ï¼‰ã€å‘å…‰ç™½è‰²ï¼ˆç”Ÿæ—¥ï¼‰
- æ‰€æœ‰äº¤äº’åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

## Bug #3: å¹´åº¦è¿›åº¦ç½‘æ ¼ç•Œé¢å¸ƒå±€ä¼˜åŒ–

### é—®é¢˜æè¿°
- **å‘ç°æ—¶é—´**: æ»šåŠ¨åŠŸèƒ½ä¿®å¤å
- **é—®é¢˜**: éœ€è¦æ»šåŠ¨æ‰èƒ½æŸ¥çœ‹æ‰€æœ‰365ä¸ªæ–¹å—ï¼Œç”¨æˆ·ä½“éªŒä¸ä½³
- **å…·ä½“è¡¨ç°**: ç”¨æˆ·éœ€è¦æ»šåŠ¨å¤šæ¬¡æ‰èƒ½çœ‹åˆ°å®Œæ•´çš„å¹´åº¦è¿›åº¦
- **é¢„æœŸè¡Œä¸º**: åœ¨å•ä¸ªé¡µé¢å†…æ˜¾ç¤ºæ‰€æœ‰365ä¸ªæ–¹å—

### æ ¹æœ¬åŸå› 
åŸå§‹çš„7åˆ—å¸ƒå±€å¯¼è‡´éœ€è¦çº¦52è¡Œæ¥æ˜¾ç¤ºæ‰€æœ‰365ä¸ªæ–¹å—ï¼Œè¶…å‡ºäº†å±å¹•æ˜¾ç¤ºèŒƒå›´ã€‚

### ä¿®å¤æ–¹æ¡ˆ
ä¼˜åŒ–`MainActivity.kt`ä¸­`GridProgressPanel`çš„å¸ƒå±€é…ç½®ï¼š
```kotlin
// ä¿®å¤å‰
LazyVerticalGrid(
    columns = GridCells.Fixed(7),
    modifier = Modifier.padding(16.dp),
    verticalArrangement = Arrangement.spacedBy(8.dp),
    horizontalArrangement = Arrangement.spacedBy(8.dp),
    userScrollEnabled = true
)

// ä¿®å¤å
LazyVerticalGrid(
    columns = GridCells.Fixed(26),  // å¢åŠ åˆ—æ•°
    modifier = Modifier.padding(2.dp),  // å‡å°‘å†…è¾¹è·
    verticalArrangement = Arrangement.spacedBy(1.dp),  // å‡å°‘é—´è·
    horizontalArrangement = Arrangement.spacedBy(1.dp),  // å‡å°‘é—´è·
    userScrollEnabled = false  // ç¦ç”¨æ»šåŠ¨ï¼Œå› ä¸ºæ‰€æœ‰å†…å®¹éƒ½å¯è§
)
```

### ä¿®å¤ç»“æœ
- æ‰€æœ‰365ä¸ªæ–¹å—åœ¨å•ä¸ªé¡µé¢å†…å¯è§ï¼ˆçº¦15è¡Œï¼‰
- ä¿æŒæ–¹å—çš„æ­£æ–¹å½¢æ¯”ä¾‹
- ä¿ç•™æ‰€æœ‰äº¤äº’åŠŸèƒ½å’Œæ»‘åŠ¨å¯¼èˆª
- æå‡ç”¨æˆ·ä½“éªŒï¼Œæ— éœ€æ»šåŠ¨å³å¯æŸ¥çœ‹å®Œæ•´å¹´åº¦è¿›åº¦

---

## Bug #4: æ™¯æ·±å£çº¸å‰æ™¯å›¾æ˜¾ç¤ºä¼˜åŒ–

### é—®é¢˜æè¿°
- **å‘ç°æ—¶é—´**: æ™¯æ·±å£çº¸åŠŸèƒ½æµ‹è¯•æœŸé—´
- **é—®é¢˜**: ç•Œé¢åˆ‡æ¢æ—¶å‰æ™¯å›¾çªå…€éšè—ï¼Œç”¨æˆ·ä½“éªŒä¸ä½³
- **å…·ä½“è¡¨ç°**: åœ¨ä¸Šä¸‹æ»‘åŠ¨åˆ‡æ¢ç•Œé¢æ—¶ï¼Œå‰æ™¯å›¾ä¼šç¬é—´æ¶ˆå¤±ï¼Œé€ æˆè§†è§‰è·³è·ƒ
- **é¢„æœŸè¡Œä¸º**: å‰æ™¯å›¾åº”è¯¥å¹³æ»‘è¿‡æ¸¡ï¼Œé¿å…çªå…€çš„æ˜¾ç¤º/éšè—æ•ˆæœ

### æ ¹æœ¬åŸå› 
åŸå§‹å®ç°ä½¿ç”¨æ¡ä»¶åˆ¤æ–­ç›´æ¥æ§åˆ¶å‰æ™¯å›¾çš„æ˜¾ç¤º/éšè—ï¼Œæ²¡æœ‰è¿‡æ¸¡åŠ¨ç”»ï¼Œå¯¼è‡´è§†è§‰æ•ˆæœçªå…€ã€‚

### ä¿®å¤æ–¹æ¡ˆ
åœ¨`MainActivity.kt`çš„`ForegroundLayer`ä¸­å®ç°é€æ˜åº¦åŠ¨ç”»ï¼š
```kotlin
// ä¿®å¤å‰
if (!_showMinimalUI.value && !_showAboutScreen.value &&
    // ... å…¶ä»–æ¡ä»¶åˆ¤æ–­
    ) {
    _foregroundUri.value?.let { uriString ->
        AsyncImage(
            model = uriString,
            contentDescription = null,
            modifier = Modifier.fillMaxSize(),
            contentScale = ContentScale.Crop
        )
    }
}

// ä¿®å¤å
val foregroundAlpha by animateFloatAsState(
    targetValue = if (!_showMinimalUI.value && !_showAboutScreen.value &&
        // ... å…¶ä»–æ¡ä»¶åˆ¤æ–­
        ) 1f else 0f,
    animationSpec = tween(durationMillis = 300),
    label = "foreground alpha"
)

_foregroundUri.value?.let { uriString ->
    AsyncImage(
        model = uriString,
        contentDescription = null,
        modifier = Modifier
            .fillMaxSize()
            .alpha(foregroundAlpha)
            .zIndex(1f),
        contentScale = ContentScale.Crop
    )
}
```

### ä¿®å¤ç»“æœ
- å‰æ™¯å›¾åœ¨ç•Œé¢åˆ‡æ¢æ—¶å¹³æ»‘æ·¡å…¥æ·¡å‡º
- æ¶ˆé™¤äº†çªå…€çš„è§†è§‰è·³è·ƒæ•ˆæœ
- ä¿æŒäº†æ‰€æœ‰åŸæœ‰åŠŸèƒ½
- æå‡äº†ç”¨æˆ·ä½“éªŒçš„æµç•…æ€§

---

## Bug #5: ç¼–è¯‘é”™è¯¯ä¿®å¤

### é—®é¢˜æè¿°
- **å‘ç°æ—¶é—´**: æ™¯æ·±å£çº¸ä¼˜åŒ–å
- **é—®é¢˜**: ç¼–è¯‘é”™è¯¯ "Unresolved reference 'zIndex'"
- **å…·ä½“è¡¨ç°**: ä»£ç æ— æ³•ç¼–è¯‘ï¼ŒIDEæŠ¥å‘ŠzIndexä¿®é¥°ç¬¦æœªå®šä¹‰
- **é¢„æœŸè¡Œä¸º**: ä»£ç åº”è¯¥æ­£å¸¸ç¼–è¯‘å’Œè¿è¡Œ

### æ ¹æœ¬åŸå› 
åœ¨æ™¯æ·±å£çº¸ä¼˜åŒ–ä¸­ä½¿ç”¨äº†`zIndex`ä¿®é¥°ç¬¦ï¼Œä½†ç¼ºå°‘ç›¸åº”çš„å¯¼å…¥è¯­å¥ã€‚

### ä¿®å¤æ–¹æ¡ˆ
åœ¨`MainActivity.kt`ä¸­æ·»åŠ ç¼ºå¤±çš„å¯¼å…¥è¯­å¥ï¼š
```kotlin
// æ·»åŠ å¯¼å…¥
import androidx.compose.ui.zIndex
```

### ä¿®å¤ç»“æœ
- ç¼–è¯‘é”™è¯¯å·²è§£å†³
- æ™¯æ·±å£çº¸åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- ä»£ç è´¨é‡å¾—åˆ°æå‡

---

## æ€»ç»“

## Bug #6: å£çº¸æ¨¡ç³ŠåŠŸèƒ½å…¼å®¹æ€§ä¿®å¤

### é—®é¢˜æè¿°
ç”¨æˆ·åæ˜ è°ƒæ•´æ¨¡ç³Šåº¦æ»‘å—æ—¶å£çº¸æ²¡æœ‰æ¨¡ç³Šæ•ˆæœï¼ŒåŒå‡»è®¾ç½®å£çº¸æ¨¡ç³ŠåŠŸèƒ½æ— æ•ˆã€‚

### æ ¹æœ¬åŸå› 
1. **Androidç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜**ï¼šJetpack Composeçš„`blur`ä¿®é¥°ç¬¦åªåœ¨Android 12 (API 31)åŠä»¥ä¸Šç‰ˆæœ¬æ”¯æŒ
2. **ç¼ºå°‘ç‰ˆæœ¬æ£€æŸ¥**ï¼šä»£ç æ²¡æœ‰é’ˆå¯¹ä¸åŒAndroidç‰ˆæœ¬æä¾›å…¼å®¹æ€§å¤„ç†
3. **ç”¨æˆ·åé¦ˆä¸è¶³**ï¼šæ²¡æœ‰å‘ç”¨æˆ·è¯´æ˜å½“å‰è®¾å¤‡æ˜¯å¦æ”¯æŒæ¨¡ç³Šæ•ˆæœ

### è§£å†³æ–¹æ¡ˆ

#### 1. æ·»åŠ Androidç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
```kotlin
// åœ¨BackgroundLayerä¸­æ·»åŠ ç‰ˆæœ¬æ£€æŸ¥
.let { modifier ->
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) {
        // Android 12+ æ”¯æŒåŸç”Ÿæ¨¡ç³Š
        modifier.blur(blurRadius.dp)
    } else {
        // Android 12ä»¥ä¸‹ç‰ˆæœ¬ï¼Œä½¿ç”¨alphaæ•ˆæœæ¨¡æ‹Ÿæ¨¡ç³Š
        modifier.alpha(if (blurRadius > 0) 0.7f else 1f)
    }
}
```

#### 2. æ·»åŠ ç”¨æˆ·æç¤ºä¿¡æ¯
```kotlin
// åœ¨æ¨¡ç³Šæ»‘å—ä¸­æ·»åŠ ç‰ˆæœ¬å…¼å®¹æ€§æç¤º
if (Build.VERSION.SDK_INT < Build.VERSION_CODES.S) {
    Text(
        text = "æ³¨æ„ï¼šå½“å‰Androidç‰ˆæœ¬ä¸æ”¯æŒæ¨¡ç³Šæ•ˆæœï¼Œä»…æ˜¾ç¤ºé€æ˜åº¦å˜åŒ–",
        style = MaterialTheme.typography.bodySmall,
        color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.7f)
    )
}
```

#### 3. æ·»åŠ è°ƒè¯•æ—¥å¿—
```kotlin
// æ·»åŠ è°ƒè¯•ä¿¡æ¯å¸®åŠ©æ’æŸ¥é—®é¢˜
LaunchedEffect(blurRadius) {
    Log.d("BlurDebug", "BackgroundLayer blur radius: $blurRadius, Android version: ${Build.VERSION.SDK_INT}")
}
```

### ä¿®å¤ç»“æœ
- âœ… **Android 12+è®¾å¤‡**ï¼šæ”¯æŒçœŸæ­£çš„æ¨¡ç³Šæ•ˆæœ
- âœ… **Android 12ä»¥ä¸‹è®¾å¤‡**ï¼šæä¾›é€æ˜åº¦å˜åŒ–ä½œä¸ºæ›¿ä»£æ•ˆæœ
- âœ… **ç”¨æˆ·ä½“éªŒæ”¹è¿›**ï¼šæ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·å½“å‰è®¾å¤‡çš„æ”¯æŒæƒ…å†µ
- âœ… **è°ƒè¯•èƒ½åŠ›å¢å¼º**ï¼šæ·»åŠ æ—¥å¿—å¸®åŠ©åç»­é—®é¢˜æ’æŸ¥

---

## æ€»ç»“

### ä¿®å¤çš„æ–‡ä»¶
- `MainActivity.kt` - ä¸»è¦çš„ç•Œé¢é€»è¾‘å’Œå¸ƒå±€æ–‡ä»¶

### ä¿®å¤çš„åŠŸèƒ½
1. **ç•Œé¢å¯¼èˆªç³»ç»Ÿ** - ä¿®å¤äº†å·¦æ»‘æ‰‹åŠ¿çš„å¯¼èˆªé€»è¾‘
2. **å¹´åº¦è¿›åº¦ç½‘æ ¼æ˜¾ç¤º** - ä¿®å¤äº†æ»šåŠ¨é—®é¢˜å¹¶ä¼˜åŒ–äº†å¸ƒå±€
3. **ç”¨æˆ·ä½“éªŒ** - ä¼˜åŒ–äº†ç•Œé¢å¸ƒå±€ï¼Œæå‡äº†å¯ç”¨æ€§
4. **æ™¯æ·±å£çº¸ä¼˜åŒ–** - å®ç°äº†å¹³æ»‘çš„å‰æ™¯å›¾è¿‡æ¸¡åŠ¨ç”»
5. **ç¼–è¯‘é—®é¢˜ä¿®å¤** - è§£å†³äº†ä¾èµ–å¯¼å…¥ç¼ºå¤±çš„ç¼–è¯‘é”™è¯¯
6. **æ¨¡ç³ŠåŠŸèƒ½å…¼å®¹æ€§** - è§£å†³äº†Androidç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ï¼Œæä¾›äº†é™çº§æ–¹æ¡ˆ
7. **æ—¶é—´æ˜¾ç¤ºå®æ—¶æ›´æ–°** - ä¿®å¤äº†å¹´åº¦è¿›åº¦ç•Œé¢æ—¶é—´ä¸å®æ—¶æ›´æ–°çš„é—®é¢˜
8. **æ¯«ç§’æ˜¾ç¤ºæ€§èƒ½ä¼˜åŒ–** - å°†æ¯«ç§’æ›´æ–°é¢‘ç‡ä»16msæå‡åˆ°8msï¼Œæé«˜æ˜¾ç¤ºæµç•…åº¦
9. **ç•Œé¢å•ä½è®¾ç½®åŒæ­¥** - äººç”Ÿè¿›åº¦ç•Œé¢çš„æ—¶é—´å•ä½ç°åœ¨å®Œå…¨ä¸å¹´åº¦è¿›åº¦ç•Œé¢åŒæ­¥ï¼Œç§»é™¤äº†ç‹¬ç«‹çš„å•ä½è®¾ç½®
10. **æ‘†çƒç•Œé¢ç™½å¤©é€‚é…** - æ·»åŠ äº†ç™½å¤©/å¤œæ™šä¸»é¢˜åˆ‡æ¢ï¼Œæ”¯æŒä¸‹é›¨æ•ˆæœ
11. **æ ¼å­ç•Œé¢ç™½å¤©æ¨¡å¼ä¼˜åŒ–** - æ ¼å­åˆ†å‰²çº¿åœ¨ç™½å¤©æ¨¡å¼ä¸‹æ”¹ä¸ºé»‘è‰²ï¼Œç”Ÿæ—¥æ ¼å­åœ¨ç™½å¤©ä½¿ç”¨é»„è‰²ï¼Œæå‡å¯è§†æ€§

### æŠ€æœ¯æ”¹è¿›
- æ­£ç¡®çš„çŠ¶æ€ç®¡ç†å’Œç•Œé¢å¯¼èˆª
- ä¼˜åŒ–çš„ç½‘æ ¼å¸ƒå±€é…ç½®
- æ”¹è¿›çš„ç”¨æˆ·äº¤äº’ä½“éªŒ
- æ·»åŠ äº†åŠ¨ç”»æ•ˆæœæå‡ç”¨æˆ·ä½“éªŒ
- å®Œå–„äº†å¯¼å…¥ä¾èµ–ç®¡ç†
- å¢å¼ºäº†Androidç‰ˆæœ¬å…¼å®¹æ€§å¤„ç†
- ç»Ÿä¸€äº†æ—¶é—´æ›´æ–°æœºåˆ¶ï¼Œç¡®ä¿æ‰€æœ‰ç•Œé¢çš„æ—¶é—´æ˜¾ç¤ºä¸€è‡´æ€§
- ä¼˜åŒ–äº†æ¯«ç§’æ›´æ–°æ€§èƒ½ï¼Œä»60fpsæå‡åˆ°120fpsï¼Œå‡å°‘è§†è§‰å»¶è¿Ÿ
- å®ç°äº†å®Œå…¨çš„ç•Œé¢é—´è®¾ç½®åŒæ­¥ï¼Œäººç”Ÿè¿›åº¦ç•Œé¢ç§»é™¤ç‹¬ç«‹å•ä½è®¾ç½®ï¼Œç›´æ¥ä½¿ç”¨å¹´åº¦è¿›åº¦ç•Œé¢çš„å•ä½é…ç½®
- å®Œå–„äº†ä¸»é¢˜é€‚é…ç³»ç»Ÿï¼Œæ‘†çƒç•Œé¢ç°åœ¨æ”¯æŒç™½å¤©/å¤œæ™šè‡ªåŠ¨åˆ‡æ¢å’Œä¸‹é›¨æ•ˆæœ

### æµ‹è¯•çŠ¶æ€
æ‰€æœ‰ä¿®å¤çš„åŠŸèƒ½éƒ½å·²ç»è¿‡æµ‹è¯•ï¼Œç¡®è®¤ï¼š
- ç•Œé¢å¯¼èˆªæµç¨‹æ­£ç¡®
- å¹´åº¦è¿›åº¦ç½‘æ ¼å®Œæ•´æ˜¾ç¤º
- æ™¯æ·±å£çº¸åŠŸèƒ½æµç•…è¿è¡Œ
- æ¨¡ç³ŠåŠŸèƒ½åœ¨ä¸åŒAndroidç‰ˆæœ¬ä¸‹æ­£å¸¸å·¥ä½œ
- å¹´åº¦è¿›åº¦ç•Œé¢æ—¶é—´å®æ—¶æ›´æ–°æ­£å¸¸å·¥ä½œ
- æ¯«ç§’æ˜¾ç¤ºæ€§èƒ½ä¼˜åŒ–ç”Ÿæ•ˆï¼Œæ˜¾ç¤ºæ›´åŠ æµç•…
- å¹´åº¦è¿›åº¦ç•Œé¢æ¯«ç§’æ›´æ–°é€Ÿåº¦ä¿®å¤ï¼ŒLaunchedEffectç°åœ¨æ­£ç¡®å“åº”è®¾ç½®å˜åŒ–
- ä¸»ç•Œé¢æ–°å¢æ—¶é—´é¢œè‰²è®¾ç½®åŠŸèƒ½ï¼Œç”¨æˆ·å¯åœ¨æ˜¾ç¤ºè®¾ç½®ä¸­è‡ªå®šä¹‰æ—¶é—´é¢œè‰²
- äººç”Ÿè¿›åº¦ç•Œé¢å®Œå…¨åŒæ­¥å¹´åº¦è¿›åº¦ç•Œé¢å•ä½è®¾ç½®ï¼Œç‹¬ç«‹å•ä½è®¾ç½®å·²ç§»é™¤
- æ‘†çƒç•Œé¢ç™½å¤©/å¤œæ™šä¸»é¢˜åˆ‡æ¢æ­£å¸¸ï¼Œä¸‹é›¨æ•ˆæœé€‚é…æ­£ç¡®
- æ ¼å­ç•Œé¢åˆ†å‰²çº¿å’Œç”Ÿæ—¥æ ¼å­é¢œè‰²åœ¨ç™½å¤©/å¤œæ™šæ¨¡å¼ä¸‹æ­£ç¡®æ˜¾ç¤º
- æ ¼å­ç•Œé¢æ·»åŠ æ™ºèƒ½é¢œè‰²é€‚é…ï¼ˆåˆ†å‰²çº¿ï¼šç™½å¤©é»‘è‰²/å¤œæ™šç™½è‰²ï¼Œç”Ÿæ—¥æ ¼å­ï¼šç™½å¤©é»„è‰²/å¤œæ™šç™½è‰²ï¼‰
- æ‰€æœ‰äº¤äº’åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- ä»£ç ç¼–è¯‘å’Œè¿è¡Œæ— é”™è¯¯
- æ— è¯Šæ–­é”™è¯¯æˆ–è­¦å‘Š

---

## Bug #7: å¹´åº¦è¿›åº¦ç•Œé¢æ—¶é—´æ˜¾ç¤ºä¸å®æ—¶æ›´æ–°

### é—®é¢˜æè¿°
- **å‘ç°æ—¶é—´**: ç”¨æˆ·åé¦ˆ
- **é—®é¢˜**: å¹´åº¦è¿›åº¦ç•Œé¢çš„ç§’å’Œæ¯«ç§’æ˜¾ç¤ºä¸æ˜¯çœŸæ­£çš„å®æ—¶æ›´æ–°
- **å…·ä½“è¡¨ç°**: åœ¨å¹´åº¦è¿›åº¦ç•Œé¢ä¸­ï¼Œå½“é€‰æ‹©æ˜¾ç¤ºç§’æˆ–æ¯«ç§’æ—¶ï¼Œæ•°å€¼ä¸ä¼šå®æ—¶å˜åŒ–ï¼Œå§‹ç»ˆæ˜¾ç¤ºç•Œé¢åˆå§‹åŒ–æ—¶çš„æ—¶é—´
- **é¢„æœŸè¡Œä¸º**: ç§’å’Œæ¯«ç§’åº”è¯¥å®æ—¶æ›´æ–°ï¼Œç‰¹åˆ«æ˜¯åœ¨é€‰æ‹©æ¯«ç§’æ˜¾ç¤ºæ—¶åº”è¯¥æœ‰æµç•…çš„æ•°å€¼å˜åŒ–

### æ ¹æœ¬åŸå› 
åœ¨`YearProgressPanel`ç»„ä»¶ä¸­ï¼Œ`currentTime`å˜é‡ä½¿ç”¨äº†`LocalDateTime.now()`ç›´æ¥èµ‹å€¼ï¼Œè¿™åªåœ¨ç»„ä»¶åˆå§‹åŒ–æ—¶è·å–ä¸€æ¬¡æ—¶é—´ï¼Œæ²¡æœ‰å®æ—¶æ›´æ–°æœºåˆ¶ã€‚ä¸ä¸»ç•Œé¢å’Œäººç”Ÿè¿›åº¦ç•Œé¢ä¸åŒï¼Œå¹´åº¦è¿›åº¦ç•Œé¢ç¼ºå°‘`LaunchedEffect`æ¥å®šæœŸæ›´æ–°æ—¶é—´çŠ¶æ€ã€‚

### è§£å†³æ–¹æ¡ˆ

#### 1. å°†é™æ€æ—¶é—´æ”¹ä¸ºåŠ¨æ€çŠ¶æ€
```kotlin
// ä¿®å¤å‰
val currentTime = LocalDateTime.now()

// ä¿®å¤å
val currentTime = remember { mutableStateOf(LocalDateTime.now()) }
```

#### 2. æ·»åŠ å®æ—¶æ›´æ–°æœºåˆ¶
```kotlin
// å®æ—¶æ›´æ–°æ—¶é—´
LaunchedEffect(Unit) {
    while (true) {
        currentTime.value = LocalDateTime.now()
        delay(if (settings.passedTimeUnit == CustomTimeUnit.MILLISECOND || settings.remainingTimeUnit == CustomTimeUnit.MILLISECOND) 16 else 1000)
    }
}
```

#### 3. æ›´æ–°æ‰€æœ‰æ—¶é—´å¼•ç”¨
```kotlin
// ä¿®å¤å‰
val isDaytime = currentTime.hour in 6..18
val remainingDays = 365 - currentTime.dayOfYear

// ä¿®å¤å
val isDaytime = currentTime.value.hour in 6..18
val remainingDays = 365 - currentTime.value.dayOfYear
```

#### 4. æ™ºèƒ½æ›´æ–°é¢‘ç‡
- **æ¯«ç§’æ˜¾ç¤º**: 16msæ›´æ–°é—´éš”ï¼ˆçº¦60fpsï¼‰ï¼Œç¡®ä¿æµç•…çš„æ¯«ç§’å˜åŒ–
- **ç§’åŠä»¥ä¸Šå•ä½**: 1000msæ›´æ–°é—´éš”ï¼ŒèŠ‚çœèµ„æº

### ä¿®å¤ç»“æœ
- âœ… **ç§’æ˜¾ç¤º**: æ¯ç§’å‡†ç¡®æ›´æ–°ï¼Œæ˜¾ç¤ºå½“å‰ç²¾ç¡®ç§’æ•°
- âœ… **æ¯«ç§’æ˜¾ç¤º**: æµç•…çš„å®æ—¶æ¯«ç§’æ›´æ–°ï¼Œæä¾›ç²¾ç¡®çš„æ—¶é—´æ„ŸçŸ¥
- âœ… **æ€§èƒ½ä¼˜åŒ–**: æ ¹æ®æ˜¾ç¤ºå•ä½æ™ºèƒ½è°ƒæ•´æ›´æ–°é¢‘ç‡
- âœ… **ä¸€è‡´æ€§**: ä¸ä¸»ç•Œé¢å’Œäººç”Ÿè¿›åº¦ç•Œé¢çš„æ—¶é—´æ›´æ–°æœºåˆ¶ä¿æŒä¸€è‡´
- âœ… **ç”¨æˆ·ä½“éªŒ**: æä¾›çœŸæ­£çš„å®æ—¶æ—¶é—´æ˜¾ç¤ºä½“éªŒ

---

## Bug #8: å¹´åº¦è¿›åº¦ç•Œé¢æ¯«ç§’æ˜¾ç¤ºæ›´æ–°ç¼“æ…¢

### é—®é¢˜æè¿°
- **å‘ç°æ—¶é—´**: æ—¶é—´å®æ—¶æ›´æ–°ä¿®å¤å
- **é—®é¢˜**: å¹´åº¦è¿›åº¦ç•Œé¢"ä»Šå¹´å·²ç»è¿‡å»äº†..."çš„æ¯«ç§’æ˜¾ç¤ºæ›´æ–°ç¼“æ…¢
- **å…·ä½“è¡¨ç°**: è™½ç„¶æ—¶é—´æœ¬èº«å®æ—¶æ›´æ–°ï¼Œä½†è¿›åº¦ç™¾åˆ†æ¯”ä¸­çš„æ¯«ç§’éƒ¨åˆ†æ›´æ–°ä¸å¤Ÿæµç•…
- **é¢„æœŸè¡Œä¸º**: æ¯«ç§’è¿›åº¦åº”è¯¥æµç•…æ›´æ–°ï¼Œä¸æ—¶é—´æ˜¾ç¤ºä¿æŒåŒæ­¥

### æ ¹æœ¬åŸå› 
åœ¨`YearProgressPanel`ä¸­ï¼Œprogressè®¡ç®—åªè€ƒè™‘äº†å¤©æ•°ï¼Œæ²¡æœ‰åŒ…å«å°æ—¶ã€åˆ†é’Ÿã€ç§’å’Œæ¯«ç§’çš„ç²¾ç¡®ä¿¡æ¯ï¼Œå¯¼è‡´æ¯«ç§’çº§åˆ«çš„è¿›åº¦å˜åŒ–ä¸æ˜æ˜¾ã€‚

### è§£å†³æ–¹æ¡ˆ

#### 1. ä¼˜åŒ–progressè®¡ç®—é€»è¾‘
```kotlin
// ä¿®å¤å‰
val progress = passedDays.toFloat() / totalDaysInYear

// ä¿®å¤å
val progress = run {
    val totalMillisecondsInYear = totalDaysInYear * 24 * 60 * 60 * 1000L
    val currentMillisecond = currentTime.value.nano / 1_000_000
    val passedMilliseconds = (passedDays - 1) * 24 * 60 * 60 * 1000L +
                           currentTime.value.hour * 60 * 60 * 1000L +
                           currentTime.value.minute * 60 * 1000L +
                           currentTime.value.second * 1000L +
                           currentMillisecond
    passedMilliseconds.toFloat() / totalMillisecondsInYear
}
```

#### 2. æå‡æ¯«ç§’æ›´æ–°é¢‘ç‡
```kotlin
// å°†æ¯«ç§’æ›´æ–°é—´éš”ä»16msæå‡åˆ°8msï¼Œå®ç°æ›´æµç•…çš„æ˜¾ç¤º
delay(if (settings.passedTimeUnit == CustomTimeUnit.MILLISECOND || settings.remainingTimeUnit == CustomTimeUnit.MILLISECOND) 8 else 1000)
```

### ä¿®å¤ç»“æœ
- âœ… **ç²¾ç¡®è¿›åº¦è®¡ç®—**: progressç°åœ¨åŒ…å«å®Œæ•´çš„æ—¶åˆ†ç§’æ¯«ç§’ä¿¡æ¯
- âœ… **æµç•…æ¯«ç§’æ›´æ–°**: ä»60fpsæå‡åˆ°120fpsï¼Œå‡å°‘è§†è§‰å»¶è¿Ÿ
- âœ… **åŒæ­¥æ˜¾ç¤º**: è¿›åº¦ç™¾åˆ†æ¯”ä¸æ—¶é—´æ˜¾ç¤ºå®Œå…¨åŒæ­¥
- âœ… **æ€§èƒ½ä¼˜åŒ–**: ä»…åœ¨éœ€è¦æ¯«ç§’æ˜¾ç¤ºæ—¶ä½¿ç”¨é«˜é¢‘æ›´æ–°
- 2024-12-19: ä¿®å¤å¹´åº¦è¿›åº¦ç•Œé¢"ä»Šå¹´å·²ç»è¿‡å»äº†..."æ¯«ç§’æ˜¾ç¤ºæ›´æ–°ç¼“æ…¢çš„é—®é¢˜ï¼Œæ”¹ç”¨ä¸å‰©ä½™æ—¶é—´ä¸€è‡´çš„å®æ—¶è®¡ç®—æ–¹å¼

---

*æ–‡æ¡£åˆ›å»ºæ—¶é—´: 2024å¹´*  
*æœ€åæ›´æ–°: å¹´åº¦è¿›åº¦ç•Œé¢æ¯«ç§’æ˜¾ç¤ºä¼˜åŒ–å®Œæˆå*

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

### å¼€å‘æŒ‡å—

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

### æŠ¥å‘Šé—®é¢˜

å¦‚æœå‘ç°bugæˆ–æœ‰åŠŸèƒ½å»ºè®®ï¼Œè¯·åœ¨ [Issues](../../issues) é¡µé¢æäº¤ã€‚

## è®¸å¯è¯

[MIT License](LICENSE)

---

*é¡¹ç›®å¼€å‘è€…: é‡åº†å¹¼å„¿å¸ˆèŒƒé«˜ç­‰ä¸“ç§‘å­¦æ ¡äººå·¥æ™ºèƒ½æŠ€æœ¯ä¸åº”ç”¨1ç­å¾è¿œè±ªPete Hsu*  
*é…·å®‰ï¼š@è¯·å«æˆ‘å¾æ€»*  
*æœ€åæ›´æ–°: 2025å¹´06æœˆ06æ—¥*

---
<a id="english-version"></a>
<details>
<summary><strong>English Version / ç‚¹å‡»æŸ¥çœ‹è‹±æ–‡ç‰ˆæœ¬</strong></summary>

<br>

# YiGeBaiJian (ä¸€ä¸ªæ‘†ä»¶)

A nifty, elegant Android app for displaying the time, with a focus on making it look good.

## What's Inside

- ğŸ• **Real-time Clock** - Supports a variety of formats and precision levels.
- ğŸ¨ **Customisable UI** - Tweak transparency, font size, colours, and all that jazz.
- ğŸ“Š **Year Progress** - Get a visual on how much of the year has slipped by.
- ğŸŒŠ **Dynamic Effects** - Snazzy wave and raindrop animations.
- âš™ï¸ **Loads of Settings** - Plenty of options to get it looking just right.

## Tech Stack

- **Language**: Kotlin
- **Framework**: Android Jetpack Compose
- **Architecture**: MVVM
- **Minimum API**: Android 21+

## Getting Started

1.  Grab the latest APK.
2.  Chuck it on your Android device and install it.
3.  Open it up. Bob's your uncle.

## Dev Environment

-   Android Studio
-   Kotlin 1.9+
-   Gradle 8.0+

## Version History

### v3.0 (The Current One)

*   Added lyrics broadcast reception feature, supporting integration with music apps like LyraPlayer.
*   Minimal Interface 4 now displays real-time lyrics, showing quotes when no lyrics available.
*   Optimized broadcast reception mechanism for improved cross-app communication stability.
*   Enhanced Android 14+ compatibility, meeting latest security requirements.
*   Improved overall user experience and feature completeness.

### v2.0

*   Fixed a sluggish millisecond display on the year progress screen.
*   Added a colour setting for the main clock.
*   Tidied up the navigation logic.
*   Polished the year progress grid view.
*   Squashed a few other UI and interaction bugs.

### v1.0

*   Initial release.
*   Basic time display.
*   Year progress view.
*   Basic settings.

## Major Fixes

Sorted out a few key issues during development:

*   **Dodgy Navigation** - Fixed a left-swipe gesture that was skipping a screen.
*   **Year Progress Grid** - Patched up scrolling and display problems.
*   **Live Time Updates** - Dealt with lag and sync issues.
*   **Millisecond Display** - Smoothed out the millisecond-level time display.
*   **UI Settings** - Added options for customising things like the time colour.

---

# Bug Squashing Diary

A log of all the bugs found and squashed during development.

## Bug #1: Funky Navigation Logic

*   **Spotted**: Early in development.
*   **The Gist**: A left-swipe gesture in the `LifeProgressPanel` was a bit wonky.
*   **What Happened**: Swiping left jumped straight to the pendulum ball screen, completely bypassing the year progress grid.
*   **What Should've Happened**: A left swipe should navigate to the `GridProgressPanel`.

### The Culprit

The swipe handling logic in `MainActivity.kt` for the `LifeProgressPanel` was mistakenly setting `_showPendulumBallPanel.value = true`, sending the user to the wrong screen.

### The Fix

Tweaked the `LifeProgressPanel`'s swipe handler in `MainActivity.kt`:

```kotlin
// Before
if (dragAmount < -100) {
    _showPendulumBallPanel.value = true
}

// After
if (dragAmount < -100) {
    _showHourglassProgress.value = true
}
```

### The Result

*   The navigation flow is now spot on: Main screen (swipe up) â†’ Year Progress (swipe left) â†’ Life Progress (swipe left) â†’ Year Grid (swipe left) â†’ Pendulum Ball.
*   All navigation is now working as it should.

---

## Bug #2: Year Progress Grid Not Showing Properly

*   **Spotted**: After the navigation fix.
*   **The Gist**: The year progress grid was only showing three rows of blue squares.
*   **What Happened**: You couldn't see all 365 day-squares.
*   **What Should've Happened**: It should display all 365 squares, one for each day of the year.

### The Culprit

In `GridProgressPanel` inside `MainActivity.kt`, the `userScrollEnabled` parameter for the `LazyVerticalGrid` was set to `false`, which, you guessed it, disabled scrolling.

### The Fix

Flicked the switch for `userScrollEnabled` in `MainActivity.kt`:

```kotlin
// Before
LazyVerticalGrid(
    columns = GridCells.Fixed(7),
    userScrollEnabled = false,  // Scrolling off
    // ...
)

// After
LazyVerticalGrid(
    columns = GridCells.Fixed(7),
    userScrollEnabled = true,   // Scrolling on
    // ...
)
```

### The Result

*   Users can now scroll vertically to see all 365 day-squares.
*   The colour-coding is correct: blue for past days, semi-transparent for future days, and a glowing white for your birthday.
*   All interactions are working as intended.

---

## Bug #3: Year Progress Grid Layout Optimisation

*   **Spotted**: After fixing the scrolling.
*   **The Gist**: Having to scroll to see all 365 squares was a bit of a pain.
*   **What Happened**: Users had to scroll a fair bit to see the whole year's progress.
*   **What Should've Happened**: All 365 squares should be visible on a single screen.

### The Culprit

The original 7-column layout meant about 52 rows were needed to show all 365 squares, which was too much for one screen.

### The Fix

Optimised the layout config for `GridProgressPanel` in `MainActivity.kt`:

```kotlin
// Before
LazyVerticalGrid(
    columns = GridCells.Fixed(7),
    modifier = Modifier.padding(16.dp),
    verticalArrangement = Arrangement.spacedBy(8.dp),
    horizontalArrangement = Arrangement.spacedBy(8.dp),
    userScrollEnabled = true
)

// After
LazyVerticalGrid(
    columns = GridCells.Fixed(26),  // More columns
    modifier = Modifier.padding(2.dp),  // Less padding
    verticalArrangement = Arrangement.spacedBy(1.dp),  // Less spacing
    horizontalArrangement = Arrangement.spacedBy(1.dp),  // Less spacing
    userScrollEnabled = false  // No need to scroll now
)
```

### The Result

*   All 365 squares are now visible on one screen (in about 15 rows).
*   The squares have kept their shape.
*   All interactive features and swipe navigation still work.
*   A much better user experience, no scrolling required.

---

## Bug #4: Depth Wallpaper Foreground Image Optimisation

*   **Spotted**: During testing of the depth wallpaper feature.
*   **The Gist**: The foreground image would abruptly disappear when switching screens, which looked a bit naff.
*   **What Happened**: When swiping up or down, the foreground image would vanish instantly, causing a visual jump.
*   **What Should've Happened**: The foreground image should transition smoothly.

### The Culprit

The original implementation used a simple conditional to show/hide the foreground image, with no transition animation.

### The Fix

Implemented a fade animation in the `ForegroundLayer` in `MainActivity.kt`:

```kotlin
// Before
if (!_showMinimalUI.value && !_showAboutScreen.value && /* ...other conditions... */) {
    _foregroundUri.value?.let { uriString ->
        AsyncImage(
            model = uriString,
            contentDescription = null,
            modifier = Modifier.fillMaxSize(),
            contentScale = ContentScale.Crop
        )
    }
}

// After
val foregroundAlpha by animateFloatAsState(
    targetValue = if (!_showMinimalUI.value && !_showAboutScreen.value && /* ...other conditions... */) 1f else 0f,
    animationSpec = tween(durationMillis = 300),
    label = "foreground alpha"
)

_foregroundUri.value?.let { uriString ->
    AsyncImage(
        model = uriString,
        contentDescription = null,
        modifier = Modifier
            .fillMaxSize()
            .alpha(foregroundAlpha)
            .zIndex(1f),
        contentScale = ContentScale.Crop
    )
}
```

### The Result

*   The foreground image now fades in and out smoothly when switching screens.
*   No more jarring visual jumps.
*   All original functionality is intact.
*   A much slicker user experience.

---

## Bug #5: Compile Error Fix

*   **Spotted**: After the depth wallpaper optimisation.
*   **The Gist**: A compile error: "Unresolved reference 'zIndex'".
*   **What Happened**: The code wouldn't compile because the `zIndex` modifier was undefined.
*   **What Should've Happened**: The code should compile and run without a hitch.

### The Culprit

The `zIndex` modifier was used in the depth wallpaper fix, but its import was missing.

### The Fix

Added the missing import statement in `MainActivity.kt`:

```kotlin
// Add this import
import androidx.compose.ui.zIndex
```

### The Result

*   Compile error sorted.
*   The depth wallpaper feature works perfectly.
*   Code quality improved.

---

## Bug #6: Wallpaper Blur Compatibility Fix

*   **Spotted**: User feedback.
*   **The Gist**: Adjusting the blur slider didn't blur the wallpaper, and the double-tap to set blur wasn't working.

### The Culprit

1.  **Android Version Compatibility**: Jetpack Compose's `blur` modifier only works on Android 12 (API 31) and newer.
2.  **Missing Version Check**: The code didn't handle different Android versions.
3.  **Lack of User Feedback**: The app didn't tell users if their device supported the blur effect.

### The Solution

#### 1. Add Android Version Check

```kotlin
// In BackgroundLayer, add a version check
.let { modifier ->
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) {
        // Android 12+ gets proper blur
        modifier.blur(blurRadius.dp)
    } else {
        // Older versions get an alpha effect to simulate it
        modifier.alpha(if (blurRadius > 0) 0.7f else 1f)
    }
}
```

#### 2. Add a Hint for the User

```kotlin
// Add a note in the blur slider
if (Build.VERSION.SDK_INT < Build.VERSION_CODES.S) {
    Text(
        text = "Heads-up: Your Android version doesn't support the blur effect, so you'll see a change in transparency instead.",
        style = MaterialTheme.typography.bodySmall,
        color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.7f)
    )
}
```

#### 3. Add Debug Logging

```kotlin
// Add debug info to help with troubleshooting
LaunchedEffect(blurRadius) {
    Log.d("BlurDebug", "BackgroundLayer blur radius: $blurRadius, Android version: ${Build.VERSION.SDK_INT}")
}
```

### The Result

*   âœ… **Android 12+ devices**: Get a proper blur effect.
*   âœ… **Devices below Android 12**: Get a transparency change as a fallback.
*   âœ… **Improved UX**: Users are now in the loop about what their device supports.
*   âœ… **Easier Debugging**: Added logs to help sort out future issues.

---

## Bug #7: Year Progress Time Not Updating in Real-Time

*   **Spotted**: User feedback.
*   **The Gist**: The seconds and milliseconds on the year progress screen weren't updating live.
*   **What Happened**: When showing seconds or milliseconds, the values were stuck at the time the screen was opened.
*   **What Should've Happened**: Seconds and milliseconds should update in real-time.

### The Culprit

In the `YearProgressPanel` component, `currentTime` was assigned with `LocalDateTime.now()` directly, grabbing the time only once. It was missing a `LaunchedEffect` to keep the time updated.

### The Solution

#### 1. Make the Time Dynamic

```kotlin
// Before
val currentTime = LocalDateTime.now()

// After
val currentTime = remember { mutableStateOf(LocalDateTime.now()) }
```

#### 2. Add a Real-Time Update Mechanism

```kotlin
// Update time in real-time
LaunchedEffect(Unit) {
    while (true) {
        currentTime.value = LocalDateTime.now()
        delay(if (settings.passedTimeUnit == CustomTimeUnit.MILLISECOND || settings.remainingTimeUnit == CustomTimeUnit.MILLISECOND) 16 else 1000)
    }
}
```

#### 3. Update All Time References

```kotlin
// Before
val isDaytime = currentTime.hour in 6..18
val remainingDays = 365 - currentTime.dayOfYear

// After
val isDaytime = currentTime.value.hour in 6..18
val remainingDays = 365 - currentTime.value.dayOfYear
```

#### 4. Smart Update Frequency

*   **Milliseconds**: Update every 16ms (about 60fps) for a smooth display.
*   **Seconds & above**: Update every 1000ms to save resources.

### The Result

*   âœ… **Seconds display**: Updates accurately every second.
*   âœ… **Milliseconds display**: Smooth, real-time millisecond updates.
*   âœ… **Performance optimisation**: Smartly adjusts update frequency.
*   âœ… **Consistency**: Matches the time update logic of other screens.
*   âœ… **Better UX**: A proper real-time experience.

---

## Bug #8: Sluggish Millisecond Updates on Year Progress

*   **Spotted**: After the real-time update fix.
*   **The Gist**: The "Year has passed by..." millisecond display on the year progress screen was still a bit laggy.
*   **What Happened**: The progress percentage's millisecond part wasn't updating as smoothly as the time display.
*   **What Should've Happened**: The millisecond progress should be silky smooth.

### The Culprit

The progress calculation in `YearProgressPanel` only considered days, not the precise hours, minutes, seconds, and milliseconds.

### The Solution

#### 1. Tweak the Progress Calculation

```kotlin
// Before
val progress = passedDays.toFloat() / totalDaysInYear

// After
val progress = run {
    val totalMillisecondsInYear = totalDaysInYear * 24 * 60 * 60 * 1000L
    val currentMillisecond = currentTime.value.nano / 1_000_000
    val passedMilliseconds = (passedDays - 1) * 24 * 60 * 60 * 1000L +
                           currentTime.value.hour * 60 * 60 * 1000L +
                           currentTime.value.minute * 60 * 1000L +
                           currentTime.value.second * 1000L +
                           currentMillisecond
    passedMilliseconds.toFloat() / totalMillisecondsInYear
}
```

#### 2. Bump Up the Update Frequency

```kotlin
// Upped the millisecond update interval from 16ms to 8ms for a smoother display
delay(if (settings.passedTimeUnit == CustomTimeUnit.MILLISECOND || settings.remainingTimeUnit == CustomTimeUnit.MILLISECOND) 8 else 1000)
```

### The Result

*   âœ… **Precise progress**: The calculation now includes full h/m/s/ms info.
*   âœ… **Smooth milliseconds**: Update rate boosted from 60fps to 120fps, reducing visual lag.
*   âœ… **Synced display**: Progress percentage is now perfectly in sync with the time.
*   âœ… **Performance boost**: Only uses high-frequency updates when needed.

---

## Fancy Contributing?

Feel free to submit an Issue or a Pull Request to make this project even better. Cheers!

### How to Chip In

1.  Fork the repo.
2.  Create a feature branch (`git checkout -b feature/AmazingFeature`).
3.  Commit your changes (`git commit -m 'Add some AmazingFeature'`).
4.  Push to the branch (`git push origin feature/AmazingFeature`).
5.  Open a Pull Request.

### Found a Bug?

If you spot a bug or have an idea for a feature, pop over to the [Issues](../../issues) page and let me know.

## Licence

[MIT License](LICENSE)

---

*Dev: Pete Hsu, Class 1, AI Tech & Application, Chongqing Preschool Education College*  
*Coolapk: @è¯·å«æˆ‘å¾æ€»*  
*Last updated: 6 June 2025*

</details>
